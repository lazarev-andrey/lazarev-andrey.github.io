"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Canvas=function(){return function(){function t(e,i,n){_classCallCheck(this,t);var s="aoc-graph";this._canvasSize={width:i,height:n},$(e).css("maxWidth",this._canvasSize.width),$(e).append('<canvas id="'+s+'" width="'+this._canvasSize.width+'" height="'+this._canvasSize.height+'" style="width:100%;"></canvas>'),this._canvasEle=$("#"+s)[0],this._canvas=this._canvasEle.getContext("2d"),this._canvasPos=this._canvasEle.getBoundingClientRect(),this._mousePos={x:0,y:0},$(this._canvasEle).click(this._click.bind(this)),$(this._canvasEle).mousemove(this._move.bind(this)),this._clickHook=null,this._mouseMoveHook=null}return _createClass(t,[{key:"getMouseX",value:function(){return this._mousePos.x}},{key:"getMouseY",value:function(){return this._mousePos.y}},{key:"getWidth",value:function(){return this._canvasSize.width}},{key:"getHeight",value:function(){return this._canvasSize.height}},{key:"getContext",value:function(){return this._canvas}},{key:"_click",value:function(t){this._updateMouseXY(t),"function"==typeof this._clickHook&&this._clickHook()}},{key:"_move",value:function(t){this._updateMouseXY(t),"function"==typeof this._mouseMoveHook&&this._mouseMoveHook()}},{key:"click",value:function(t){this._clickHook=t}},{key:"mousemove",value:function(t){this._mouseMoveHook=t}},{key:"clear",value:function(){this._canvas.clearRect(0,0,this._canvasSize.width,this._canvasSize.height)}},{key:"drawLine",value:function(t,e,i,n,s){var a="#000",o=1,r=1;void 0!=s&&(void 0!=s.color&&(a=s.color),void 0!=s.alpha&&(o=s.alpha),void 0!=s.width&&(r=s.width)),this._canvas.shadowBlur=0,this._canvas.globalAlpha=o,this._canvas.strokeStyle=a,this._canvas.lineWidth=r,this._canvas.beginPath(),this._canvas.moveTo(t,e),this._canvas.lineTo(i,n),this._canvas.stroke()}},{key:"drawCircle",value:function(t,e,i){var n=1,s="#000",a=1;void 0!=i&&(void 0!=i.size&&(n=i.size),void 0!=i.color&&(s=i.color),void 0!=i.alpha&&(a=i.alpha)),this._canvas.shadowColor="#666",this._canvas.shadowBlur=15,this._canvas.shadowOffsetX=0,this._canvas.shadowOffsetY=0,this._canvas.globalAlpha=a,this._canvas.fillStyle=s,this._canvas.beginPath(),this._canvas.arc(t,e,n,0,2*Math.PI),this._canvas.fill()}},{key:"drawRectangle",value:function(t,e,i,n,s){var a="#000",o=1;void 0!=s&&(void 0!=s.fill&&(a=s.fill),void 0!=s.alpha&&(o=s.alpha)),this._canvas.shadowBlur=0,this._canvas.globalAlpha=o,this._canvas.fillStyle=a,this._canvas.fillRect(t,e,i,n)}},{key:"_updateMouseXY",value:function(t){this._canvasPos=this._canvasEle.getBoundingClientRect();var e=t.clientX-this._canvasPos.left,i=t.clientY-this._canvasPos.top,n=$(this._canvasEle).width()/this._canvasSize.width,s=$(this._canvasEle).height()/this._canvasSize.height,a=Math.floor(e/n),o=Math.floor(i/s);this._mousePos.x=a,this._mousePos.y=o}}]),t}()}(),ACArtist=function(){return function(){function t(e,i){_classCallCheck(this,t),this._ac=e,this._canvas=i,this._canvas.click(this._click.bind(this)),this._draw(),this._animationIterator=null,this._animationSteps=10,this._iterationHook=null;for(var n in this)"function"==typeof this[n]&&(this[n]=this[n].bind(this))}return _createClass(t,[{key:"_click",value:function(){var t=this._ac.getGraph().getCities();for(var e in t){var i=0;if(i+=Math.abs(t[e].getX()-this._canvas.getMouseX()),(i+=Math.abs(t[e].getY()-this._canvas.getMouseY()))<30)return}this._ac.getGraph().addCity(this._canvas.getMouseX(),this._canvas.getMouseY()),this._ac.getGraph().createEdges(),clearInterval(this._animationIterator),this._ac.reset(),this._draw()}},{key:"_draw",value:function(){this._canvas.clear(),this._drawBg(),this._drawEdges(),this._drawNodes(),this._drawCurrentBest()}},{key:"_drawCurrentBest",value:function(){var t=this._ac.getGlobalBest();if(null!=t&&null!=t.getTour())for(var e=t.getTour(),i=0;i<e.size();i++)i<e.size()-1?this._canvas.drawLine(e.get(i).getX(),e.get(i).getY(),e.get(i+1).getX(),e.get(i+1).getY(),{alpha:.9,color:"#0c6",width:3}):this._canvas.drawLine(e.get(i).getX(),e.get(i).getY(),e.get(0).getX(),e.get(0).getY(),{alpha:.9,color:"#0c6",width:3})}},{key:"_drawNodes",value:function(){var t=this._ac.getGraph().getCities();for(var e in t)this._canvas.drawCircle(t[e].getX(),t[e].getY(),{alpha:.8})}},{key:"_drawEdges",value:function(){var t=this._ac.getGraph().getEdges(),e=0;for(var i in t)e+=t[i].getPheromone();for(var i in t){var n=.2;if(this._ac.currentIteration()>0){var s=Math.ceil(t[i].getPheromone()/e*this._ac.getGraph().size()*6);n=t[i].getPheromone()/e*this._ac.getGraph().size()+.03,n>1&&(n=1)}this._canvas.drawLine(t[i].pointA().x,t[i].pointA().y,t[i].pointB().x,t[i].pointB().y,{alpha:n,color:"#06f",width:s})}}},{key:"_drawBg",value:function(){var t=this._canvas.getContext().createLinearGradient(0,0,0,this._canvas.getHeight());t.addColorStop(0,"#fcfcfc"),t.addColorStop(.4,"#fcfcfc"),t.addColorStop(1,"#fcfcfc"),this._canvas.drawRectangle(0,0,this._canvas.getWidth(),this._canvas.getHeight(),{fill:t})}},{key:"stop",value:function(){clearInterval(this._animationIterator),this._ac.reset(),this._draw()}},{key:"clearGraph",value:function(){this.stop(),this._ac.getGraph().clear(),this._draw()}},{key:"runAC",value:function(t){this._ac.ready()&&("function"==typeof t&&(this._iterationHook=t),clearInterval(this._animationIterator),this._ac.reset(),this._step())}},{key:"_step",value:function(t){if(this._ac.currentIteration()>=this._ac.maxIterations())return this._draw(),void this._ac.resetAnts();for(var e=0;e<3;e++)this._ac.step();this._animateAnts(),"function"==typeof this._iterationHook&&this._iterationHook()}},{key:"_moveAnt",value:function(t,e,i){var n=(t.getTour().size(),t.getTour().get(e-1)),s=t.getTour().get(e),a=(s.getX()-n.getX())*(1/this._animationSteps*i),o=(s.getY()-n.getY())*(1/this._animationSteps*i),r=n.getX()+a,h=n.getY()+o;this._drawAnt(r,h)}},{key:"_drawAnt",value:function(t,e){this._canvas.drawRectangle(t-2,e-2,4,4,{alpha:.5})}},{key:"_animateAnts",value:function(){var t=this,e=2;this._animationIterator=setInterval(function(){t._draw();var i=t._ac.getAnts();for(var n in i)t._moveAnt(i[n],1,e);++e>=t._animationSteps&&(clearInterval(t._animationIterator),t._step())},20)}}]),t}()}(),Graph=function(){return function(){function t(){_classCallCheck(this,t),this._cities=[],this._edges={}}return _createClass(t,[{key:"getEdges",value:function(){return this._edges}},{key:"getEdgeCount",value:function(){return Object.keys(this._edges).length}},{key:"getCity",value:function(t){return this._cities[t]}},{key:"getCities",value:function(){return this._cities}},{key:"size",value:function(){return this._cities.length}},{key:"addCity",value:function(t,e){this._cities.push(new City(t,e))}},{key:"_addEdge",value:function(t,e){this._edges[t.toString()+"-"+e.toString()]=new Edge(t,e)}},{key:"getEdge",value:function(t,e){return void 0!=this._edges[t.toString()+"-"+e.toString()]?this._edges[t.toString()+"-"+e.toString()]:void 0!=this._edges[e.toString()+"-"+t.toString()]?this._edges[e.toString()+"-"+t.toString()]:void 0}},{key:"createEdges",value:function(){this._edges={};for(var t=0;t<this._cities.length;t++)for(var e=t;e<this._cities.length;e++)this._addEdge(this._cities[t],this._cities[e])}},{key:"resetPheromone",value:function(){for(var t in this._edges)this._edges[t].resetPheromone()}},{key:"clear",value:function(){this._cities=[],this._edges={}}}]),t}()}(),City=function(){return function(){function t(e,i){_classCallCheck(this,t),this._x=e,this._y=i}return _createClass(t,[{key:"getX",value:function(){return this._x}},{key:"getY",value:function(){return this._y}},{key:"toString",value:function(){return this._x+","+this._y}},{key:"isEqual",value:function(t){return this._x==t._x&&this._y==t._y}}]),t}()}(),Edge=function(){return function(){function t(e,i){_classCallCheck(this,t),this._cityA=e,this._cityB=i,this._initPheromone=1,this._pheromone=this._initPheromone;var n=Math.pow(e.getX()-i.getX(),2),s=Math.pow(e.getY()-i.getY(),2);this._distance=Math.sqrt(n+s)}return _createClass(t,[{key:"pointA",value:function(){return{x:this._cityA.getX(),y:this._cityA.getY()}}},{key:"pointB",value:function(){return{x:this._cityB.getX(),y:this._cityB.getY()}}},{key:"getPheromone",value:function(){return this._pheromone}},{key:"getDistance",value:function(){return this._distance}},{key:"contains",value:function(t){return this._cityA.getX()==t.getX()||this._cityB.getX()==t.getX()}},{key:"setInitialPheromone",value:function(t){this._initPheromone=t}},{key:"setPheromone",value:function(t){this._pheromone=t}},{key:"resetPheromone",value:function(){this._pheromone=this._initPheromone}}]),t}()}(),AntColony=function(){return function(){function t(e){_classCallCheck(this,t),this._graph=new Graph,this._colony=[],this._colonySize=20,this._alpha=1,this._beta=3,this._rho=.1,this._q=1,this._initPheromone=this._q,this._type="acs",this._elitistWeight=0,this._maxIterations=250,this._minScalingFactor=.001,this.setParams(e),this._iteration=0,this._minPheromone=null,this._maxPheromone=null,this._iterationBest=null,this._globalBest=null,this._createAnts()}return _createClass(t,[{key:"getGraph",value:function(){return this._graph}},{key:"getAnts",value:function(){return this._colony}},{key:"size",value:function(){return this._colony.length}},{key:"currentIteration",value:function(){return this._iteration}},{key:"maxIterations",value:function(){return this._maxIterations}},{key:"_createAnts",value:function(){this._colony=[];for(var t=0;t<this._colonySize;t++)this._colony.push(new Ant(this._graph,{alpha:this._alpha,beta:this._beta,q:this._q}))}},{key:"setParams",value:function(t){void 0!=t&&(void 0!=t.colonySize&&(this._colonySize=t.colonySize),void 0!=t.alpha&&(this._alpha=t.alpha),void 0!=t.beta&&(this._beta=t.beta),void 0!=t.rho&&(this._rho=t.rho),void 0!=t.iterations&&(this._maxIterations=t.iterations),void 0!=t.q&&(this._q=t.q),void 0!=t.initPheromone&&(this._initPheromone=t.initPheromone),void 0!=t.type&&("elitist"==t.type?void 0!=t.elitistWeight&&(this._elitistWeight=t.elitistWeight,this._type="elitist"):"maxmin"==t.type?this._type="maxmin":this._type="acs"),void 0!=t.minScalingFactor&&(this._minScalingFactor=t.minScalingFactor))}},{key:"reset",value:function(){this._iteration=0,this._globalBest=null,this.resetAnts(),this.setInitialPheromone(this._initPheromone),this._graph.resetPheromone()}},{key:"setInitialPheromone",value:function(){var t=this._graph.getEdges();for(var e in t)t[e].setInitialPheromone(this._initPheromone)}},{key:"resetAnts",value:function(){this._createAnts(),this._iterationBest=null}},{key:"ready",value:function(){return!(this._graph.size()<=1)}},{key:"run",value:function(){if(this.ready())for(this._iteration=0;this._iteration<this._maxIterations;)this.step()}},{key:"step",value:function(){if(this.ready()&&!(this._iteration>=this._maxIterations)){this.resetAnts();for(var t in this._colony)this._colony[t].run();this.getGlobalBest(),this.updatePheromone(),this._iteration++}}},{key:"updatePheromone",value:function(){var t=this._graph.getEdges();for(var e in t){var i=t[e].getPheromone();t[e].setPheromone(i*(1-this._rho))}if("maxmin"==this._type){if(this._iteration/this._maxIterations>.75)var n=this.getGlobalBest();else var n=this.getIterationBest();this._maxPheromone=this._q/n.getTour().distance(),this._minPheromone=this._maxPheromone*this._minScalingFactor,n.addPheromone()}else for(var s in this._colony)this._colony[s].addPheromone();if("elitist"==this._type&&this.getGlobalBest().addPheromone(this._elitistWeight),"maxmin"==this._type)for(var e in t){var i=t[e].getPheromone();i>this._maxPheromone?t[e].setPheromone(this._maxPheromone):i<this._minPheromone&&t[e].setPheromone(this._minPheromone)}}},{key:"getIterationBest",value:function(){if(null==this._colony[0].getTour())return null;if(null==this._iterationBest){var t=this._colony[0];for(var e in this._colony)t.getTour().distance()>=this._colony[e].getTour().distance()&&(this._iterationBest=this._colony[e])}return this._iterationBest}},{key:"getGlobalBest",value:function(){var t=this.getIterationBest();return null==t&&null==this._globalBest?null:(null!=t&&(null==this._globalBest||this._globalBest.getTour().distance()>=t.getTour().distance())&&(this._globalBest=t),this._globalBest)}}]),t}()}(),Ant=function(){return function(){function t(e,i){_classCallCheck(this,t),this._graph=e,this._alpha=i.alpha,this._beta=i.beta,this._q=i.q,this._tour=null}return _createClass(t,[{key:"reset",value:function(){this._tour=null}},{key:"init",value:function(){this._tour=new Tour(this._graph);var t=Math.floor(Math.random()*this._graph.size());this._currentCity=this._graph.getCity(t),this._tour.addCity(this._currentCity)}},{key:"getTour",value:function(){return this._tour}},{key:"makeNextMove",value:function(){null==this._tour&&this.init();var t=0,e=this._graph.getCities(),i=[];for(var n in e)if(!this._tour.contains(e[n])){var s=this._graph.getEdge(this._currentCity,e[n]);if(1==this._alpha)var a=s.getPheromone();else var a=Math.pow(s.getPheromone(),this._alpha);i[n]=a*(1/Math.pow(s.getDistance(),this._beta)),t+=i[n]}var o=t*Math.random(),r=0;for(var n in e)if(!this._tour.contains(e[n])&&(r+=i[n])>=o)return this._currentCity=e[n],void this._tour.addCity(e[n])}},{key:"tourFound",value:function(){return null!=this._tour&&this._tour.size()>=this._graph.size()}},{key:"run",value:function(t){for(this.reset();!this.tourFound();)this.makeNextMove()}},{key:"addPheromone",value:function(t){void 0==t&&(t=1);for(var e=this._q*t/this._tour.distance(),i=0;i<this._tour.size();i++)if(i>=this._tour.size()-1){var n=this._tour.get(i),s=this._tour.get(0),a=this._graph.getEdge(n,s),o=a.getPheromone();a.setPheromone(o+e)}else{var n=this._tour.get(i),s=this._tour.get(i+1),a=this._graph.getEdge(n,s),o=a.getPheromone();a.setPheromone(o+e)}}}]),t}()}(),Tour=function(){return function(){function t(e){_classCallCheck(this,t),this._graph=e,this._tour=[],this._distance=null}return _createClass(t,[{key:"size",value:function(){return this._tour.length}},{key:"contains",value:function(t){for(var e in this._tour)if(t.isEqual(this._tour[e]))return!0;return!1}},{key:"addCity",value:function(t){this._distance=null,this._tour.push(t)}},{key:"get",value:function(t){return this._tour[t]}},{key:"distance",value:function t(){if(null==this._distance){for(var t=0,e=0;e<this._tour.length;e++)if(e>=this._tour.length-1){var i=this._graph.getEdge(this._tour[e],this._tour[0]);t+=i.getDistance()}else{var i=this._graph.getEdge(this._tour[e],this._tour[e+1]);t+=i.getDistance()}this._distance=t}return this._distance}}]),t}()}();$(document).ready(function(){function t(){var t={type:$("#aco-mode").val(),colonySize:$("#colony-size").val(),alpha:$("#alpha").val(),beta:$("#beta").val(),rho:$("#rho").val(),iterations:$("#max-iterations").val(),elitistWeight:$("#elitist-weight").val(),initPheromone:$("#init-pheromone").val(),q:$("#pheromone-deposit-weight").val(),minScalingFactor:$("#min-scalar").val()};i.setParams(t)}var e=new Canvas("#aco-canvas",940,600),i=new AntColony,n=new ACArtist(i,e);$("#aco-params select").change(function(){n.stop(),t()}),$("#aco-mode").change(function(){$("#elitist-weight-input").hide(),$(".maxmin-params").hide(),"elitist"==$(this).val()?$("#elitist-weight-input").show():"maxmin"==$(this).val()&&$(".maxmin-params").show()}),t(),$("#start-search-btn").click(function(){i.ready()||loadPopup({msg:"Please add at least two destination nodes"}),$(".aco-info").show(),$("#iteration-info").html("0/"+i.maxIterations()),$("#best-distance").html("-"),n.runAC(function(){$("#iteration-info").html(i.currentIteration()+"/"+i.maxIterations()),$("#best-distance").html(i.getGlobalBest().getTour().distance().toFixed(2))})}),$("#clear-graph").click(n.clearGraph)});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),TSP=function(){var t={Point:function(t,e){this.x=t,this.y=e},randomInt:function(t){return Math.floor(Math.random()*(t+1))},distance:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},algorithms:{},extensions:[],register:function(t){for(var e in t)if(t.hasOwnProperty(e)&&"name"!==e&&"key"!==e){t.key=e,this.algorithms[e]=t;break}},getAlgorithm:function(t){var e=this.algorithms[t];if(void 0!==e)return e[e.key]},extendAlgorithm:function(t,e,i){this.extensions.push({destination:t,srcKey:e,propertyKey:i})},processExtensions:function(){for(var t=void 0,e=void 0;t=this.extensions.pop();)void 0!==(e=this.getAlgorithm(t.srcKey))&&(t.destination.prototype[t.propertyKey]=e.prototype[t.propertyKey])}},e=function(){function e(t){_classCallCheck(this,e),this.notify=t,this.points=[],this.solution=[],this.timeout=0}return _createClass(e,[{key:"addPoint",value:function(e,i){this.points.push(new t.Point(e,i))}},{key:"solve",value:function(e){if(!(this.timeout>0||0==this.points.length)){this.iteration=0,this.improvements=0,this.distance=Number.MAX_VALUE,this.time=0,t.processExtensions();var i=t.getAlgorithm(e),n=this;if(void 0===i)throw"Algorithm ["+e+"] not found.";this.algo=new i(this),this.timeout=setTimeout(function(){n.iterate()},0)}}},{key:"iterate",value:function(){var t=this.algo.solve(),e=this.pathDistance(t),i=this;e<this.distance&&(this.distance=e,this.solution=t,this.improvements++),this.iteration++,this.notify(),this.algo.done?this.timeout=0:this.timeout=setTimeout(function(){i.iterate()},0)}},{key:"stop",value:function(){clearTimeout(this.timeout),this.timeout=0}},{key:"clear",value:function(){this.stop(),this.points=[],this.solution=[]}},{key:"getPossible",value:function(){for(var t=[],e=this.points.length,i=0;i<e;i++)t.push(i);return t}},{key:"pathDistance",value:function(e){for(var i=this.points,n=i.length,s=t.distance,a=s(i[e[0]],i[e[n-1]]),o=1;o<n;o++)a+=s(i[e[o]],i[e[o-1]]);return a}}]),e}();return t.Solver=e,t}(),_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function t(e){_classCallCheck(this,t),this.solver=e,this.done=!1,this.shortest=Number.MAX_VALUE,this.index=0}return _createClass(t,[{key:"solve",value:function(){this.index>=this.solver.points.length-1&&(this.done=!0);var t=this.nearestNeighborPath(),e=this.solver.pathDistance(t);return e<this.shortest&&(this.shortest=e,this.best=t),this.index++,this.best}}]),t}(),i=function(){var e=t.distance,i=this.solver.getPossible(),n=this.solver.points,s=[i[this.index]];for(i.splice(this.index,1);i.length>0;){for(var a=Number.MAX_VALUE,o=0,r=s[s.length-1],h=0;h<i.length;h++){var c=e(n[r],n[i[h]]);c<a&&(a=c,o=h)}s.push(i[o]),i.splice(o,1)}return s};e.prototype.nearestNeighborPath=i,t.register({name:"Nearest Neighbor",NearestNeighbor:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(t){_classCallCheck(this,e),this.init(t),this.setUpCandidates()}return _createClass(e,[{key:"init",value:function(t){this.solver=t,this.possible=t.getPossible(),this.solution=[this.possible[0]],this.candidates=[],this.distances=[],this.depth=0,this.currentDistance=0,this.bestDistance=Number.MAX_VALUE,this.best=[]}},{key:"setUpCandidates",value:function(){this.candidates.push(this.possible.filter(function(t){return!this.solution.includes(t)},this))}},{key:"solve",value:function(){for(var e=0,i=this.solver.points,n=this.solution,s=0,a=void 0,o=void 0;e++<1e3;)if(a=this.candidates[this.candidates.length-1],0===a.length){if(this.backup(),this.depth<0){this.done=!0;break}}else if(this.depth===i.length-2)o=a[0],s=t.distance(i[n[n.length-1]],i[o])+t.distance(i[n[0]],i[o]),s+this.currentDistance<this.bestDistance&&(this.bestDistance=s+this.currentDistance,this.best=n.slice(),this.best.push(o)),this.backup();else{o=a.pop(),s=t.distance(i[n[n.length-1]],i[o]),n.push(o),this.currentDistance+=s;var r=this.getLowerBound(a);this.currentDistance+r>=this.bestDistance?(this.currentDistance-=s,n.pop()):(this.distances.push(s),this.depth++,this.setUpCandidates())}return this.best}},{key:"backup",value:function(){--this.depth>=0&&(this.candidates.pop(),this.solution.pop(),this.currentDistance-=this.distances.pop())}},{key:"getLowerBound",value:function(){return 0}}]),e}();t.register({name:"Brute Force",BruteForce:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(t){_classCallCheck(this,e),this.init(t),this.initCachedDistances(),this.setUpCandidates()}return _createClass(e,[{key:"initCachedDistances",value:function(){this.cachedDistances=[];for(var e=this.solver.points,i=0;i<e.length;i++){this.cachedDistances[i]=[];for(var n=i+1;n<e.length;n++)this.cachedDistances[i][n-i-1]=t.distance(e[i],e[n])}}},{key:"setUpCandidates",value:function(){var t=this.solution[this.solution.length-1],e=this.possible.filter(function(t){return!this.solution.includes(t)},this).map(function(e){return{index:e,distance:this.lookupDistance(t,e)}},this);e.sort(i),this.candidates.push(e.map(function(t){return t.index}))}},{key:"lookupDistance",value:function(t,e){var i=Math.min(t,e),n=Math.max(t,e);return this.cachedDistances[i][n-i-1]}},{key:"getLowerBound",value:function(t){var e=0,i=Number.MAX_VALUE,n=Number.MAX_VALUE,s=this.solution[0],a=this.solution[this.solution.length-1],o=0,r=Number.MAX_VALUE;return t.forEach(function(h){i=Math.min(i,this.lookupDistance(s,h)),n=Math.min(n,this.lookupDistance(a,h)),r=Number.MAX_VALUE,t.forEach(function(t){h!==t&&(r=Math.min(r,this.lookupDistance(h,t)))},this),r<o?e+=r:(e+=o,o=r)},this),e+i+n}}]),e}();t.extendAlgorithm(e,"BruteForce","init"),t.extendAlgorithm(e,"BruteForce","solve"),t.extendAlgorithm(e,"BruteForce","backup");var i=function(t,e){return e.distance-t.distance};t.register({name:"Branch & Bound",BranchNBound:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(t){_classCallCheck(this,e),this.solver=t;for(var i=[],n=0;n<100;n++)i.push(this.randomIndividual());i.sort(this.sortDistance),this.population=i}return _createClass(e,[{key:"sortDistance",value:function(t,e){return t.distance-e.distance}},{key:"randomIndividual",value:function(){var t={gene:this.randomSolution()};return t.distance=this.solver.pathDistance(t.gene),t}},{key:"getSurvivors",value:function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.population[t[i]]);return e}},{key:"mutate",value:function(e,i){for(var n=e.gene.slice(0),s=0;s<i;s++){var a=t.randomInt(n.length-1),o=n[a];n.splice(a,1),n.splice(t.randomInt(n.length-1),0,o)}var r={gene:n};return r.distance=this.solver.pathDistance(r.gene),r}},{key:"crossover",value:function(e,i){for(var n=[],s=e.gene.length,a=i.gene.slice(0),o=t.randomInt(s-1),r=t.randomInt(s-1);o===r;)r=t.randomInt(s-1);for(;o!==r;){var h=e.gene[o];n.push(h),a.splice(a.indexOf(h),1),++o===s&&(o=0)}for(var c=0;c<a.length;c++)n.push(a[c]);var l={gene:n};return l.distance=this.solver.pathDistance(n),l}},{key:"solve",value:function(){var e=this.getSurvivors([0,1,2,4,10,25,35,55,95]),i=e.length,n=0,s=0,a=void 0;for(n=0;n<i;n++)for(s=0;s<i;s++)n!==s&&(a=this.crossover(e[n],e[s]),a=this.mutate(a,t.randomInt(2)),e.push(a));for(;e.length<100;)e.push(this.randomIndividual());return e.sort(this.sortDistance),this.population=e,e[0].gene}}]),e}();t.extendAlgorithm(e,"OneRandom","randomSolution"),t.register({name:"Genetic Algorithm",GA:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(t){_classCallCheck(this,e),this.solver=t,this.done=!0}return _createClass(e,[{key:"randomSolution",value:function(){for(var e=[],i=this.solver.getPossible();i.length>0;){var n=t.randomInt(i.length-1);e.push(i[n]),i.splice(n,1)}return e}},{key:"solve",value:function(){return this.randomSolution()}}]),e}();t.register({name:"One Random Solution",OneRandom:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function t(e){_classCallCheck(this,t),this.solver=e}return _createClass(t,[{key:"solve",value:function(){return this.randomSolution()}}]),t}();t.extendAlgorithm(e,"OneRandom","randomSolution"),t.register({name:"Iterate Random Solutions",IterateRandom:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(t){_classCallCheck(this,e),this.solver=t,this.done=!1,this.best=this.randomSolution()}return _createClass(e,[{key:"solve",value:function(){for(var e=this.solver.points,i=e.length,n=0,s=this.best,a=t.distance,o=0;o<i;o++){var r=o+1;r===i&&(r=0);for(var h=a(e[s[o]],e[s[r]]),c=o+1;c<i;c++){var l=c+1;c===i-1&&(l=0);var u=h+a(e[s[c]],e[s[l]]),v=a(e[s[o]],e[s[c]])+a(e[s[r]],e[s[l]]),f=u-v;if(f>n){n=f;for(var _=[],d=r;d%i!==l;)_.push(s[d%i]),d++;for(d=o;d%i!==c;)_.push(s[d%i]),--d<0&&(d=i-1);this.best=_}}}return n<=0&&(this.done=!0),this.best}}]),e}();t.extendAlgorithm(e,"OneRandom","randomSolution"),t.register({name:"2-Optimization Algorithm",TwoOptBest:e})}(TSP);var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=1,i="#06f",n=.5,s=2*Math.PI,a=function(){function a(e,i){_classCallCheck(this,a),"function"!=typeof i&&(i=function(){});var n=this;this.canvas=e,this.ctx=e.getContext("2d");var s=function(){n.improvements!==n.solver.improvements&&(n.draw(),n.improvements=n.solver.improvements),i({distance:n.solver.distance,iteration:n.solver.iteration,improvements:n.solver.improvements})};this.solver=new t.Solver(s),e.addEventListener("mousedown",function(t){var e=t.clientX-this.offsetLeft+(window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft),i=t.clientY-this.offsetTop+(window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop);n.solver.solution=[],n.solver.addPoint(e,i),n.draw()})}return _createClass(a,[{key:"draw",value:function(){var t=this.solver.points,a=t.length,o=this.solver.solution,r=this.ctx,h=0;for(r.clearRect(0,0,this.canvas.width,this.canvas.height),h=0;h<a;h++)r.beginPath(),r.arc(t[h].x,t[h].y,e,0,s,!0),r.fill();if(a>1&&o.length>1){for(r.save(),r.strokeStyle=i,r.lineWidth=n,r.moveTo(t[o[0]].x,t[o[0]].y),h=1;h<a;h++)r.lineTo(t[o[h]].x,t[o[h]].y);r.lineTo(t[o[0]].x,t[o[0]].y),r.stroke(),r.restore()}}},{key:"addRandom",value:function(e){var i=parseInt(e,10),n=(this.solver.points,0);if(this.solver.solution=[],!isNaN(i)){for(;n<i;n++)this.solver.addPoint(t.randomInt(this.canvas.width),t.randomInt(this.canvas.height));this.draw()}}},{key:"solve",value:function(t){this.improvements=0,this.solver.solve(t)}},{key:"clear",value:function(){this.solver.clear(),this.draw()}},{key:"stop",value:function(){this.solver.stop()}}]),a}();t.UI=a}(TSP),function(){var t=function(t){return document.getElementById(t)},e=t("thecanvas"),i=t("spnDistance"),n=t("spnIteration"),s=t("spnImprovement"),a=t("spnPointCount"),o=t("ddlAlg"),r=function(t){i.innerHTML=t.distance,n.innerHTML=t.iteration,s.innerHTML=t.improvements,spnTime.innerHTML=t.time},h=new TSP.UI(e,r);for(var c in TSP.algorithms)o.appendChild(new Option(TSP.algorithms[c].name,c));t("btnAddRandom").addEventListener("click",function(){h.addRandom(t("txtAddCount").value),a.innerHTML=h.solver.points.length}),t("btnClear").addEventListener("click",function(){h.clear()}),t("btnGo").addEventListener("click",function(){h.solve(o.value)}),t("btnStop").addEventListener("click",function(){h.stop()}),e.addEventListener("mousedown",function(){setTimeout(function(){a.innerHTML=h.solver.points.length},0)})}();